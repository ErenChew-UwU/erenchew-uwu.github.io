<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旋转镜像 + 数学破碎背景 + iframe</title>
    <link rel="shortcut icon" href="./image/icon_logo.png">
    <link rel="stylesheet" href="./styles/style_all.css">
    <link rel="stylesheet" href="./styles/style_background.css">
    <link rel="stylesheet" href="./styles/style_flip.css">
    <style>
        .world-current { background:#444; z-index:11; }
        .world-mirror { background:#111; }
    </style>
</head>
<body>
    <!-- 数学破碎背景 -->
    <div class="math-broken-bg">
        <div class="math-formulas" id="math-formulas"></div>
        <div class="broken-grid"></div>
        <div class="broken-squares"></div>
    </div>
    <!-- 3D旋转场景 -->
    <div id="scene-container">
    <div id="world-3d">
        <div class="world-layer world-current">镜像世界</div>
        <div class="world-layer world-mirror"><iframe id="mirror-iframe" src="index.html"></iframe></div>
    </div>
    </div>
    <div id="flip-mask"></div>
    <button id="flip-btn">回到现实世界</button>
</body>
<script src="./scripts/background_animation.js"></script>
<script>
    const world3d = document.getElementById('world-3d');
    const mirrorIframe = document.getElementById('mirror-iframe');
    const flipMask = document.getElementById('flip-mask');
    const flipBtn = document.getElementById('flip-btn');

    let isFlipping = false;

    //反转动画
    flipBtn.addEventListener('click', () => {
        if(isFlipping) return;
        isFlipping = true;
        flipBtn.style.opacity = 0;
        const windowHeight = window.innerHeight;

        try {
            startBg();
        } catch(e) {
            console.warn("Background animation not loaded:", e);
        }

        // 让 iframe 在旋转途中可见
        mirrorIframe.style.opacity = 1;

        // 开始动画：旋转 180° + 放大 + 退后 + 遮罩
        world3d.style.transform = `translateZ(-2000px) translateY(-${windowHeight}px) rotateZ(180deg) scale(1.05)`;
        flipMask.style.background = 'rgba(255,50,50,0.2)';

        // 动画结束后固定视角
        setTimeout(()=>{
            world3d.style.transform = 'translateZ(0) rotateZ(180deg) scale(1)';
            flipMask.style.background = 'rgba(255,50,50,0)';
            isFlipping=false;
        }, 2500);

        // 动画结束后正式跳转
        setTimeout(()=> {
            try {
                stopBg();
            } catch(e) {
                console.warn("Background animation failed to stop:", e);
            }
            window.location.href = "index.html";
        }, 5000);
    });
</script>
</html>
